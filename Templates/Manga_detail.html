{% extends 'Layout.html' %}

{% block title %}{{ manga.title if manga else 'Detalle del Manga' }}{% endblock %}

{% block body %}
<div class="container mt-4">
    {% if error %}
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-triangle"></i> {{ error }}
        <div class="mt-3">
            <a href="{{ url_for('mangas.browse_manga') }}" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Volver a Explorar
            </a>
        </div>
    </div>
    {% elif manga %}
    <div class="row">
        <!-- Imagen del Manga -->
        <div class="col-md-3">
            {% if manga.thumb %}
            <img src="{{ manga.thumb }}" class="img-fluid rounded shadow" alt="{{ manga.title }}">
            {% else %}
            <div class="bg-secondary d-flex align-items-center justify-content-center rounded shadow" 
                 style="height: 400px;">
                <i class="fas fa-book fa-5x text-white"></i>
            </div>
            {% endif %}
        </div>

        <!-- Información del Manga -->
        <div class="col-md-9">
            <h1>{{ manga.title }}</h1>
            
            {% if manga.alternativeTitles %}
            <p class="text-muted">
                <strong>Títulos alternativos:</strong> {{ manga.alternativeTitles|join(', ') }}
            </p>
            {% endif %}

            <div class="mb-3">
                {% if manga.type %}
                <span class="badge badge-info badge-lg">{{ manga.type }}</span>
                {% endif %}
                {% if manga.status %}
                <span class="badge badge-success badge-lg">{{ manga.status }}</span>
                {% endif %}
            </div>

            {% if manga.genres %}
            <div class="mb-3">
                <strong>Géneros:</strong><br>
                {% for genre in manga.genres %}
                <span class="badge badge-secondary mr-1 mb-1">{{ genre }}</span>
                {% endfor %}
            </div>
            {% endif %}

            {% if manga.authors %}
            <p><strong>Autores:</strong> {{ manga.authors|join(', ') }}</p>
            {% endif %}

            {% if manga.year %}
            <p><strong>Año:</strong> {{ manga.year }}</p>
            {% endif %}

            {% if manga.rating %}
            <p><strong>Rating:</strong> 
                <span class="text-warning">
                    {% for i in range(5) %}
                        {% if i < manga.rating %}
                            <i class="fas fa-star"></i>
                        {% else %}
                            <i class="far fa-star"></i>
                        {% endif %}
                    {% endfor %}
                </span>
                ({{ manga.rating }}/5)
            </p>
            {% endif %}

            {% if manga.description %}
            <div class="card mt-3">
                <div class="card-header">
                    <strong>Sinopsis</strong>
                </div>
                <div class="card-body">
                    <p>{{ manga.description }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Capítulos -->
    <div class="row mt-5">
        <div class="col-md-12">
            <h2><i class="fas fa-list"></i> Capítulos</h2>
            {% if chapters %}
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Capítulo</th>
                                    <th>Título</th>
                                    <th>Fecha</th>
                                    <th>Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for chapter in chapters %}
                                <tr>
                                    <td>
                                        <strong>{{ chapter.chapterNumber or chapter.number or 'N/A' }}</strong>
                                    </td>
                                    <td>{{ chapter.title or chapter.name or 'Sin título' }}</td>
                                    <td>
                                        {% if chapter.date %}
                                        <small class="text-muted">{{ chapter.date }}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('mangas.manga_chapter', chapter_id=chapter._id or chapter.id) }}" 
                                           class="btn btn-sm btn-primary">
                                            <i class="fas fa-book-open"></i> Leer
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No hay capítulos disponibles para este manga.
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Botón de Volver -->
    <div class="row mt-4">
        <div class="col-md-12">
            <a href="{{ url_for('mangas.browse_manga') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver a Explorar
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
